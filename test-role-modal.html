<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Role Modal Test - Secret Hitler</title>
    <link rel="stylesheet" href="styles/app.css">
    <link rel="stylesheet" href="pages/parts/play-styles.css">
    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-scenario {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-scenario h3 {
            margin-top: 0;
            color: #333;
        }
        .test-scenario p {
            margin: 10px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🎭 Role Modal Test - Secret Hitler</h1>
        <p>This test page demonstrates the new three-button role modal functionality.</p>
        
                 <div class="test-scenario">
             <h3>🧪 Test Scenarios</h3>
             <p><strong>Liberal Player:</strong> Should see membership and role buttons enabled, comrades button disabled</p>
             <p><strong>Fascist at 5-6 players:</strong> All three buttons should be enabled (including comrades)</p>
             <p><strong>Fascist at 7-10 players:</strong> All three buttons should be enabled (including comrades)</p>
             <p><strong>Hitler:</strong> Same behavior as other Fascists - can see comrades at 5+ players</p>
         </div>

        <div class="test-scenario">
            <h3>🎯 Test the Modal</h3>
            <button class="test-button" onclick="testLiberalPlayer()">Test Liberal Player</button>
                         <button class="test-button" onclick="testFascist5Players()">Test Fascist (5 players) - Can See Comrades</button>
             <button class="test-button" onclick="testFascist7Players()">Test Fascist (7 players) - Can See Comrades</button>
             <button class="test-button" onclick="testFascist8Players()">Test Fascist (8 players) - Can See Comrades</button>
             <button class="test-button" onclick="testHitler()">Test Hitler (5 players) - Can See Comrades</button>
        </div>

        <div class="test-scenario">
            <h3>📱 Responsive Test</h3>
            <p>Resize your browser window to test mobile responsiveness. The buttons should stack vertically on small screens.</p>
        </div>
    </div>

    <!-- Role overlay modal -->
    <div id="role-overlay" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">Your Secret Role</div>
                <button id="role-close" class="modal-close" aria-label="Close">×</button>
            </div>
            <div class="modal-body">
                <div class="role-content">
                    <div class="role-display">
                        <div class="role-label" id="role-text">Hidden</div>
                    </div>
                                         <div class="role-actions">
                         <div class="role-actions-main">
                             <button id="membership-btn" class="btn btn-secondary">🏛️ View Membership</button>
                             <button id="role-btn" class="btn btn-primary">👁️ View Role</button>
                             <button id="compatriots-btn" class="btn btn-secondary" disabled>👥 View Comrades</button>
                         </div>
                         <button id="role-done-btn" class="btn">✅ Close</button>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data for testing
        let mockPlayers = [];
        let mockGame = { playerCount: 5 };
        let currentPlayer = null;

        // Test functions
        function testLiberalPlayer() {
            mockPlayers = [
                { id: '1', name: 'Alice', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '2', name: 'Bob', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '3', name: 'Charlie', role: 'FASCIST', party: 'FASCIST' },
                { id: '4', name: 'David', role: 'FASCIST', party: 'FASCIST' },
                { id: '5', name: 'Eve', role: 'HITLER', party: 'FASCIST' }
            ];
            mockGame.playerCount = 5;
            currentPlayer = mockPlayers[0]; // Alice (Liberal)
            openRoleOverlay();
        }

        function testFascist5Players() {
            mockPlayers = [
                { id: '1', name: 'Alice', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '2', name: 'Bob', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '3', name: 'Charlie', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '4', name: 'David', role: 'FASCIST', party: 'FASCIST' },
                { id: '5', name: 'Eve', role: 'HITLER', party: 'FASCIST' }
            ];
            mockGame.playerCount = 5;
            currentPlayer = mockPlayers[3]; // David (Fascist)
            openRoleOverlay();
        }

        function testFascist7Players() {
            mockPlayers = [
                { id: '1', name: 'Alice', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '2', name: 'Bob', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '3', name: 'Charlie', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '4', name: 'David', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '5', name: 'Eve', role: 'FASCIST', party: 'FASCIST' },
                { id: '6', name: 'Frank', role: 'FASCIST', party: 'FASCIST' },
                { id: '7', name: 'Grace', role: 'HITLER', party: 'FASCIST' }
            ];
            mockGame.playerCount = 7;
            currentPlayer = mockPlayers[4]; // Eve (Fascist)
            openRoleOverlay();
        }

        function testFascist8Players() {
            mockPlayers = [
                { id: '1', name: 'Alice', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '2', name: 'Bob', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '3', name: 'Charlie', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '4', name: 'David', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '5', name: 'Eve', role: 'FASCIST', party: 'FASCIST' },
                { id: '6', name: 'Frank', role: 'FASCIST', party: 'FASCIST' },
                { id: '7', name: 'Grace', role: 'FASCIST', party: 'FASCIST' },
                { id: '8', name: 'Henry', role: 'HITLER', party: 'FASCIST' }
            ];
            mockGame.playerCount = 8;
            currentPlayer = mockPlayers[4]; // Eve (Fascist)
            openRoleOverlay();
        }

        function testHitler() {
            mockPlayers = [
                { id: '1', name: 'Alice', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '2', name: 'Bob', role: 'LIBERAL', party: 'LIBERAL' },
                { id: '3', name: 'Charlie', role: 'FASCIST', party: 'FASCIST' },
                { id: '4', name: 'David', role: 'FASCIST', party: 'FASCIST' },
                { id: '5', name: 'Eve', role: 'HITLER', party: 'FASCIST' }
            ];
            mockGame.playerCount = 5;
            currentPlayer = mockPlayers[4]; // Eve (Hitler)
            openRoleOverlay();
        }

        // Mock functions to simulate the game environment
        function getGameId() { return 'test-game'; }
        function computeYouId() { return currentPlayer ? currentPlayer.id : null; }
        function setRoleBannerVisibility() {} // No-op for testing

        // Core functions (copied from the main implementation)
                 function setupButtonPermissions(youPlayer, game, membershipBtn, roleBtn, compatriotsBtn) {
             const playerCount = game.playerCount || mockPlayers.length;
             const isFascist = (youPlayer.party || '').toString().toUpperCase() === 'FASCIST' || 
                               (youPlayer.role || '').toString().toUpperCase() === 'FASCIST';
             
             // Debug logging to help troubleshoot
             console.log('setupButtonPermissions debug:', {
                 playerCount,
                 isFascist,
                 party: youPlayer.party,
                 role: youPlayer.role,
                 gamePlayerCount: game.playerCount,
                 mockPlayersLength: mockPlayers.length
             });
             
             // Membership and role always available
             membershipBtn.disabled = false;
             roleBtn.disabled = false;
             
                           // Comrades button logic:
              // - Fascists at 5+ players: Can see their allies
              // - Liberals: Always enabled with fun message about not knowing teammates
              if (isFascist && playerCount >= 5) {
                  // Fascists can see comrades at 5+ players
                  compatriotsBtn.disabled = false;
                  compatriotsBtn.style.opacity = '1';
                  compatriotsBtn.title = 'View your Fascist allies';
                  console.log('Comrades button ENABLED for Fascist at', playerCount, 'players');
              } else if (!isFascist) {
                  // Liberals always get the comrades button with fun message
                  compatriotsBtn.disabled = false;
                  compatriotsBtn.style.opacity = '1';
                  compatriotsBtn.title = 'See what Liberals see (hint: nothing!)';
                  console.log('Comrades button ENABLED for Liberal player');
              } else {
                  // Fascists at <5 players can't see comrades yet
                  compatriotsBtn.disabled = true;
                  compatriotsBtn.style.opacity = '0.6';
                  compatriotsBtn.title = `Fascists can see allies at 5+ players (current: ${playerCount})`;
                  console.log('Comrades button DISABLED for Fascist at', playerCount, 'players');
              }
             
             // Add visual feedback for button states
             membershipBtn.title = 'View your party membership and role details';
             roleBtn.title = 'Toggle between hidden and revealed role';
         }
        
                 // Helper function to close all views and reset to hidden state
         function closeAllViews(roleText) {
             roleText.textContent = 'Hidden';
             roleText.style.color = '#000';
             
             // Reset button states back to original
             const membershipBtn = document.getElementById('membership-btn');
             const roleBtn = document.getElementById('role-btn');
             
             if (membershipBtn) {
                 membershipBtn.textContent = '🏛️ View Membership';
                 membershipBtn.style.background = 'rgba(0, 174, 239, 0.1)';
                 membershipBtn.style.borderColor = 'var(--liberal-blue)';
             }
             
             if (roleBtn) {
                 roleBtn.textContent = '👁️ View Role';
                 roleBtn.style.background = 'var(--highlight-cream)';
                 roleBtn.style.borderColor = 'var(--propaganda-black)';
             }
         }
         
         function showMembership(youPlayer, roleText, membershipBtn) {
             const party = (youPlayer.party || '').toString().toUpperCase();
             
             // Check if membership is currently shown or hidden
             const isCurrentlyShown = roleText.textContent.includes('Party:') && 
                                    !roleText.textContent.includes('Hidden') &&
                                    !roleText.textContent.includes('Your Fascist Comrades:') &&
                                    !roleText.textContent.includes('No other Fascist players');
             
             if (isCurrentlyShown) {
                 // Hide membership - return to hidden state
                 roleText.textContent = 'Hidden';
                 roleText.style.color = '#000';
                 membershipBtn.textContent = '🏛️ View Membership';
                 membershipBtn.style.background = 'rgba(0, 174, 239, 0.1)';
                 membershipBtn.style.borderColor = 'var(--liberal-blue)';
             } else {
                 // Close any other views first
                 closeAllViews(roleText);
                 
                 // Show membership
                 roleText.textContent = `Party: ${party}`;
                 membershipBtn.textContent = '🙈 Hide Membership';
                 roleText.style.color = '#000';
                 membershipBtn.style.background = 'var(--highlight-cream)';
                 membershipBtn.style.borderColor = 'var(--propaganda-black)';
             }
             
             // Add subtle animation
             roleText.style.animation = 'none';
             roleText.offsetHeight; // Trigger reflow
             roleText.style.animation = 'fadeIn 0.3s ease-in-out';
         }
        
                 function showRole(youPlayer, roleText, roleBtn) {
             const role = (youPlayer.role || '').toString().toUpperCase();
             const party = (youPlayer.party || '').toString().toUpperCase();
             
             // Check if role is currently hidden or shown
             const isCurrentlyHidden = roleText.textContent === 'Hidden' || 
                                     roleText.textContent.includes('Party:') ||
                                     roleText.textContent.includes('Your Fascist Comrades:') ||
                                     roleText.textContent.includes('No other Fascist players');
             
             if (isCurrentlyHidden) {
                 // Close any other views first
                 closeAllViews(roleText);
                 
                 const label = role ? `${role}${party && role !== party ? ' – ' + party : ''}` : 'Not assigned yet';
                 roleText.textContent = label;
                 
                 // Set colors based on role
                 if (role === 'HITLER') roleText.style.color = '#DA291C';
                 else if (party === 'FASCIST' || role === 'FASCIST') roleText.style.color = '#DA291C';
                 else roleText.style.color = '#00AEEF';
                 
                 roleBtn.textContent = '🙈 Hide Role';
                 roleBtn.style.background = 'rgba(218, 41, 28, 0.1)';
                 roleBtn.style.borderColor = '#DA291C';
             } else {
                 roleText.textContent = 'Hidden';
                 roleText.style.color = '#000';
                 roleBtn.textContent = '👁️ View Role';
                 roleBtn.style.background = 'var(--highlight-cream)';
                 roleBtn.style.borderColor = 'var(--propaganda-black)';
             }
             
             // Add subtle animation
             roleText.style.animation = 'none';
             roleText.offsetHeight; // Trigger reflow
             roleText.style.animation = 'fadeIn 0.3s ease-in-out';
         }
        
                                   function showCompatriots(youPlayer, game, roleText) {
              const isFascist = (youPlayer.party || '').toString().toUpperCase() === 'FASCIST' || 
                                (youPlayer.role || '').toString().toUpperCase() === 'FASCIST';
              
              // Close any other views first
              closeAllViews(roleText);
              
              if (isFascist) {
                  // Handle Fascist players
                  const fascistPlayers = mockPlayers.filter(p => 
                      p && p.id !== youPlayer.id && 
                      ((p.party || '').toString().toUpperCase() === 'FASCIST' || 
                       (p.role || '').toString().toUpperCase() === 'FASCIST')
                  );
                  
                  if (fascistPlayers.length === 0) {
                      roleText.textContent = 'No other Fascist players to reveal';
                      roleText.style.color = '#000';
                  } else {
                      const names = fascistPlayers.map(p => p.name || 'Unknown Player').join('\n');
                      roleText.textContent = `Your Fascist Comrades:\n${names}`;
                      roleText.style.color = '#DA291C';
                  }
              } else {
                  // Handle Liberal players with fun message
                  roleText.textContent = '🤷‍♂️ Your Liberal Comrades:';
                  roleText.style.color = '#00AEEF';
              }
              
              // Add subtle animation
              roleText.style.animation = 'none';
              roleText.offsetHeight; // Trigger reflow
              roleText.style.animation = 'fadeIn 0.3s ease-in-out';
          }

        function openRoleOverlay() {
            const roleOverlay = document.getElementById('role-overlay');
            const roleText = document.getElementById('role-text');
            const membershipBtn = document.getElementById('membership-btn');
            const roleBtn = document.getElementById('role-btn');
            const compatriotsBtn = document.getElementById('compatriots-btn');
            const doneBtn = document.getElementById('role-done-btn');
            
            if (!roleOverlay || !roleText || !membershipBtn || !roleBtn || !compatriotsBtn || !doneBtn) {
                console.error('Role modal elements not found');
                return;
            }
            
            if (!currentPlayer) {
                roleText.textContent = 'Please select a test scenario first';
                roleText.style.color = '#666';
                return;
            }
            
            // Set up button states and permissions
            setupButtonPermissions(currentPlayer, mockGame, membershipBtn, roleBtn, compatriotsBtn);
            
                         // Set up event listeners
             membershipBtn.onclick = () => showMembership(currentPlayer, roleText, membershipBtn);
             roleBtn.onclick = () => showRole(currentPlayer, roleText, roleBtn);
             compatriotsBtn.onclick = () => showCompatriots(currentPlayer, mockGame, roleText);
            doneBtn.onclick = () => {
                roleOverlay.style.display = 'none';
            };
            
            // Start with hidden role
            roleText.textContent = 'Hidden';
            roleText.style.color = '#000';
            
            // Show overlay with smooth transition
            roleOverlay.style.display = 'flex';
            roleOverlay.style.animation = 'fadeIn 0.3s ease-in-out';
        }

        // Close modal when clicking outside or on close button
        document.getElementById('role-close').onclick = function() {
            document.getElementById('role-overlay').style.display = 'none';
        };

        document.getElementById('role-overlay').onclick = function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        };
    </script>
</body>
</html>
