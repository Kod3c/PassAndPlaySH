<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play - Secret Hitler</title>
    <link rel="stylesheet" href="../styles/app.css">
    <link rel="stylesheet" href="parts/play-styles.css">
    <link rel="stylesheet" href="parts/play-specific.css">
    <meta name="theme-color" content="#101820">
    <meta name="theme-color" content="#101820">
    <script src="../js/theme.js"></script>
</head>
<body>
    <div class="play-wrapper">
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo" onclick="window.location.href='../index.html'">
                        <span class="logo-icon">üé≠</span>
                        <div class="logo-text">
                            <h1>Secret Hitler</h1>
                            <p class="subtitle">Mobile Edition</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <!-- Theme toggle removed -->
                    </div>
                </div>
            </div>
        </header>

        <main class="play-main">
            <div class="board-shell">
                <div id="role-banner" class="floating-role">
                    <div class="role-bar"><span id="role-badge" class="role-tag"></span></div>
                </div>
                <div id="players-strip" class="players-strip"></div>
                <div class="board-area">
                    <div class="board-frame">
                        <div class="tracks">
                            <section class="track liberal">
                                <div class="track-title">Liberal Policies</div>
                                <div class="slots" id="liberal-slots"></div>
                            </section>
                            <div id="status" class="status-banner">Loading‚Ä¶</div>
                            <section class="track fascist">
                                <div class="track-title">Fascist Policies</div>
                                <div class="slots" id="fascist-slots"></div>
                            </section>
                        </div>
                        <div class="policy-summary">
                            <div class="policy-card-wrap">
                                <div class="policy-card-title">Liberal Policies</div>
                                <div class="policy-chip liberal"><span class="policy-label">Liberal</span> <span class="count" id="liberal-count">0/5</span></div>
                            </div>
                            <div class="policy-card-wrap">
                                <div class="policy-card-title">Fascist Policies</div>
                                <div class="policy-chip fascist"><span class="policy-label">Fascist</span> <span class="count" id="fascist-count">0/6</span></div>
                            </div>
                        </div>
                        <div class="tracker-row">
                            <div class="tracker-label">Failed Elections</div>
                            <div class="tracker" id="election-tracker"></div>
                        </div>
                    </div>
                    <!-- Cards area - centered under play field -->
                    <div class="cards-area" aria-hidden="false">
                        <div class="cards-row">
                            <div class="role-envelope" id="role-envelope" title="Click to view your secret role">
                                <img src="../images/my-role.png" alt="My Secret Role" class="envelope-image">
                            </div>
                            <div class="table-spread">
                                <!-- Table cards will be dynamically generated here -->
                            </div>
                            <div class="card-stack discard" aria-label="Discard Pile">
                                <div class="stack-card is-discard"></div>
                                <!-- Policy cards will be dynamically generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        

        <footer class="floating-footer">
            <div class="actions-bar">
                <div class="actions-left">
                    <button id="menu-btn" class="btn">‚ò∞ Menu</button>
                    <button id="help-btn" class="btn">üìñ Rules</button>
                </div>
                <div class="actions-center">
                    <button id="view-cards-btn" class="btn btn-primary" style="display: none;">üÉè View Cards</button>
                    <button id="repair-game-main-btn" class="btn" style="display: none;" title="Repair game state issues">üîß Repair</button>
                </div>
                <div class="actions-right">
                    <button id="history-btn" class="btn">üïí History</button>
                    <button id="order-btn" class="btn">üë• Order</button>
                </div>
            </div>
        </footer>
        <div id="order-modal" class="modal-overlay">
            <div class="modal-card">
                <div class="modal-header">
                    <div class="modal-title">Player Order</div>
                    <button id="order-close" class="modal-close" aria-label="Close">√ó</button>
                </div>
                <div id="order-body" class="modal-body"></div>
            </div>
        </div>
        <div id="history-modal" class="modal-overlay">
            <div class="modal-card">
                <div class="modal-header">
                    <div class="modal-title">History</div>
                    <button id="history-close" class="modal-close" aria-label="Close">√ó</button>
                </div>
                <div id="history-body" class="modal-body"></div>
            </div>
        </div>
        <div id="nomination-modal" class="modal-overlay">
            <div class="modal-card">
                <div class="modal-header">
                    <div class="modal-title">Choose Chancellor</div>
                    <button id="nomination-close" class="modal-close" aria-label="Close">√ó</button>
                </div>
                <div id="nomination-body" class="modal-body"></div>
            </div>
        </div>
        <div id="rules-modal" class="modal-overlay rules-modal">
            <div class="modal-card">
                <div class="modal-header">
                    <div>
                        <div class="modal-title">Game Rules</div>
                        <div class="modal-subtitle">Quick reference for in-game use</div>
                    </div>
                    <button id="rules-close" class="modal-close" aria-label="Close">√ó</button>
                </div>
                <div id="rules-body" class="modal-body">
                    <div class="rules-quicknav">
                        <button class="rule-nav-btn active" data-section="ov" aria-label="Overview">
                            <span class="nav-icon" aria-hidden="true">üéØ</span>
                            <span class="nav-text">Overview</span>
                        </button>
                        <button class="rule-nav-btn" data-section="setup" aria-label="Setup">
                            <span class="nav-icon" aria-hidden="true">‚öôÔ∏è</span>
                            <span class="nav-text">Setup</span>
                        </button>
                        <button class="rule-nav-btn" data-section="roles" aria-label="Roles">
                            <span class="nav-icon" aria-hidden="true">üé≠</span>
                            <span class="nav-text">Roles</span>
                        </button>
                        <button class="rule-nav-btn" data-section="flow" aria-label="Turn Order">
                            <span class="nav-icon" aria-hidden="true">üîÑ</span>
                            <span class="nav-text">Turn Order</span>
                        </button>
                        <button class="rule-nav-btn" data-section="powers" aria-label="Powers">
                            <span class="nav-icon" aria-hidden="true">‚ö°</span>
                            <span class="nav-text">Powers</span>
                        </button>
                        <button class="rule-nav-btn" data-section="legislative" aria-label="Legislative">
                            <span class="nav-icon" aria-hidden="true">üìú</span>
                            <span class="nav-text">Legislative</span>
                        </button>
                        <button class="rule-nav-btn" data-section="win" aria-label="Victory">
                            <span class="nav-icon" aria-hidden="true">üèÜ</span>
                            <span class="nav-text">Victory</span>
                        </button>
                        <button class="rule-nav-btn" data-section="ref" aria-label="Reference">
                            <span class="nav-icon" aria-hidden="true">üìë</span>
                            <span class="nav-text">Reference</span>
                        </button>
                    </div>
                    <div class="rules-content">
                        <section id="ov-section" class="rule-section active">
                            <div class="section-header">
                                <div class="section-icon">üéØ</div>
                                <h3>Game Overview</h3>
                            </div>
                            <div class="overview-grid">
                                <div class="overview-card">
                                    <div class="card-icon">üë•</div>
                                    <h4>Teams</h4>
                                    <p>Liberals vs Fascists</p>
                                    <span class="card-detail">Hidden roles</span>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">üé¥</div>
                                    <h4>Policies</h4>
                                    <p>6 Fascist / 5 Liberal to win</p>
                                    <span class="card-detail">See Victory</span>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">üî®</div>
                                    <h4>Offices</h4>
                                    <p>President & Chancellor</p>
                                    <span class="card-detail">Rotate order</span>
                                </div>
                            </div>
                        </section>

                        <section id="setup-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">‚öôÔ∏è</div>
                                <h3>Setup</h3>
                            </div>
                            <div class="setup-steps">
                                <div class="setup-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Choose Roles by Player Count</h4>
                                        <div class="role-distribution-visual">
                                            <div class="role-example"><div class="role-badge liberal"><span class="role-icon">üü¶</span>Liberals</div><span class="role-count">5 players: 3L, 1F, 1H</span></div>
                                            <div class="role-example"><div class="role-badge liberal"><span class="role-icon">üü¶</span>Liberals</div><span class="role-count">6 players: 4L, 1F, 1H</span></div>
                                            <div class="role-example"><div class="role-badge liberal"><span class="role-icon">üü¶</span>Liberals</div><span class="role-count">7 players: 4L, 2F, 1H</span></div>
                                            <div class="role-example"><div class="role-badge liberal"><span class="role-icon">üü¶</span>Liberals</div><span class="role-count">8 players: 5L, 2F, 1H</span></div>
                                            <div class="role-example"><div class="role-badge liberal"><span class="role-icon">üü¶</span>Liberals</div><span class="role-count">9 players: 5L, 3F, 1H</span></div>
                                            <div class="role-example"><div class="role-badge liberal"><span class="role-icon">üü¶</span>Liberals</div><span class="role-count">10 players: 6L, 3F, 1H</span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="setup-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Prepare Decks</h4>
                                        <p>Policy deck: 11 Fascist, 6 Liberal. Shuffle and place face down; discards face down. When fewer than 3 remain, reshuffle discards into a new deck.</p>
                                    </div>
                                </div>
                                <div class="setup-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Seat & Select First President</h4>
                                        <p>Sit randomly around the table; assign player order clockwise. Randomly choose the first Presidential candidate.</p>
                                    </div>
                                </div>
                                <div class="setup-step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <h4>Secret Information (Night Phase)</h4>
                                        <ul>
                                            <li>5‚Äì6 players: Hitler learns the identity of the single Fascist. The Fascist does not learn Hitler.</li>
                                            <li>7‚Äì10 players: Fascists learn one another. Hitler does not know the Fascists and the Fascists do not know Hitler.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section id="roles-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">üé≠</div>
                                <h3>Roles & Knowledge</h3>
                            </div>
                            <div class="roles-grid">
                                <div class="role-card liberal"><div class="role-header"><div class="role-icon">üü¶</div><h4>Liberal</h4></div><div class="role-info"><p class="role-description">Work together to enact 5 Liberal policies or execute Hitler.</p><div class="role-abilities"><h5>You know:</h5><ul><li>Only that you are Liberal.</li></ul></div></div></div>
                                <div class="role-card fascist"><div class="role-header"><div class="role-icon">üü•</div><h4>Fascist</h4></div><div class="role-info"><p class="role-description">Coordinate covertly to enact 6 Fascist policies or elect Hitler after 3 Fascist policies.</p><div class="role-abilities"><h5>You know:</h5><ul><li>Other Fascists (7‚Äì10 players).</li><li>Hitler's identity is unknown to you.</li></ul></div></div></div>
                                <div class="role-card hitler"><div class="role-header"><div class="role-icon">üëë</div><h4>Hitler</h4></div><div class="role-info"><p class="role-description">Deceive the Liberals and avoid detection.</p><div class="role-abilities"><h5>You know:</h5><ul><li>At 5‚Äì6 players: the single Fascist.</li><li>At 7‚Äì10 players: no one.</li></ul></div></div></div>
                            </div>
                        </section>

                        <section id="flow-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">üîÑ</div>
                                <h3>Turn Order</h3>
                            </div>
                            <div class="gameplay-flow">
                                <div class="flow-step">
                                    <div class="flow-icon">üëë</div>
                                    <h4>Nominate</h4>
                                    <p>President nominates a Chancellor.</p>
                                </div>
                                <div class="flow-arrow">‚Üí</div>
                                <div class="flow-step">
                                    <div class="flow-icon">üó≥Ô∏è</div>
                                    <h4>Vote</h4>
                                    <p>All players vote Ja/Nein. Majority passes.</p>
                                </div>
                                <div class="flow-arrow">‚Üí</div>
                                <div class="flow-step">
                                    <div class="flow-icon">üé¥</div>
                                    <h4>Legislate</h4>
                                    <p>Pres draws 3, discards 1; Chanc enacts 1 of 2.</p>
                                </div>
                                <div class="flow-arrow">‚Üí</div>
                                <div class="flow-step">
                                    <div class="flow-icon">‚ö°</div>
                                    <h4>Powers</h4>
                                    <p>Some Fascist policies trigger powers.</p>
                                </div>
                            </div>
                        </section>

                        <section id="powers-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">‚ö°</div>
                                <h3>Executive Powers</h3>
                            </div>
                            <div class="powers-grid">
                                <div class="power-card">
                                    <div class="power-header">
                                        <span class="power-number">3</span>
                                        <h4>Policy Peek</h4>
                                    </div>
                                    <p>President looks at top 3 policy cards.</p>
                                </div>
                                <div class="power-card">
                                    <div class="power-header">
                                        <span class="power-number">4</span>
                                        <h4>Investigation</h4>
                                    </div>
                                    <p>President checks a player's loyalty.</p>
                                </div>
                                <div class="power-card">
                                    <div class="power-header">
                                        <span class="power-number">5</span>
                                        <h4>Special Election</h4>
                                    </div>
                                    <p>President picks the next Presidential candidate.</p>
                                </div>
                            </div>
                            <div class="power-notes">
                                <div class="notes-header"><div class="notes-icon">üìè</div><h4>Power Timing by Player Count</h4></div>
                                <ul>
                                    <li><strong>5‚Äì6 players</strong>: 3 Policy Peek, 4 Execution, 5 Execution.</li>
                                    <li><strong>7‚Äì8 players</strong>: 2 Investigation, 3 Special Election, 4 Execution, 5 Execution.</li>
                                    <li><strong>9‚Äì10 players</strong>: 1 Investigation, 2 Investigation, 3 Special Election, 4 Execution, 5 Execution.</li>
                                </ul>
                            </div>
                        </section>

                        <section id="legislative-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">üìú</div>
                                <h3>Legislative Session & Veto</h3>
                            </div>
                            <div class="powers-intro"><div class="powers-header"><div class="powers-icon">üé¥</div><p>President draws 3 policies, discards 1 face down, passes 2 to Chancellor. Chancellor discards 1 and enacts 1 face down.</p></div></div>
                            <ul>
                                <li>All discards and enacted cards are secret (face down).</li>
                                <li>If fewer than 3 remain in deck, reshuffle the discard pile to form a new deck.</li>
                                <li><strong>Veto Power</strong> unlocks after 5 Fascist policies are enacted. Chancellor may propose a veto; if the President agrees, discard both cards and advance the Election Tracker by 1 (no policy is enacted).</li>
                                <li>Top-deck policies (after 3 failed elections) do not trigger Executive Powers.</li>
                            </ul>
                            <div class="powers-intro"><div class="powers-header"><div class="powers-icon">üö´</div><p><strong>Eligibility & Term Limits:</strong> The last elected President and last elected Chancellor are ineligible to be nominated as Chancellor in the next government. No player can be Chancellor in two consecutive governments.</p></div></div>
                        </section>

                        <section id="win-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">üèÜ</div>
                                <h3>Victory Conditions</h3>
                            </div>
                            <div class="winning-conditions">
                                <div class="win-condition liberal-win">
                                    <div class="win-header">
                                        <div class="win-icon">üü¶</div>
                                        <h4>Liberals</h4>
                                    </div>
                                    <div class="win-ways">
                                        <div class="win-way"><span class="way-icon">‚úÖ</span><span class="way-text">Pass 5 Liberal policies</span></div>
                                        <div class="win-way"><span class="way-icon">üéØ</span><span class="way-text">Execute Hitler</span></div>
                                    </div>
                                </div>
                                <div class="win-condition fascist-win">
                                    <div class="win-header">
                                        <div class="win-icon">üü•</div>
                                        <h4>Fascists</h4>
                                    </div>
                                    <div class="win-ways">
                                        <div class="win-way"><span class="way-icon">‚úÖ</span><span class="way-text">Pass 6 Fascist policies</span></div>
                                        <div class="win-way"><span class="way-icon">üëë</span><span class="way-text">Elect Hitler Chancellor after 3 Fascist policies</span></div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section id="ref-section" class="rule-section">
                            <div class="section-header">
                                <div class="section-icon">üìë</div>
                                <h3>Reference</h3>
                            </div>
                            <div class="pdf-actions">
                                <a class="btn btn-outline" href="../Secret_Hitler_Rules.pdf" target="_blank" rel="noopener">Open Official Rules (PDF)</a>
                                <a class="btn" href="../Secret_Hitler_Rules.pdf" download>Download PDF</a>
                            </div>
                            <p class="mt-3" style="text-align:center;color:var(--dark-beige);">This in-game summary covers all core rules. Use the PDF for full artwork and extended clarifications.</p>
                        </section>
                    </div>
                    <div class="rules-bottomnav" aria-hidden="false">
                        <div class="rules-bottomnav-inner">
                            <button id="rules-prev" class="btn" aria-label="Previous section">‚Üê Prev</button>
                            <div id="rules-indicator" class="indicator">1/7</div>
                            <button id="rules-next" class="btn btn-primary" aria-label="Next section">Next ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="menu-modal" class="modal-overlay">
                <div class="modal-card">
                    <div class="modal-header">
                        <div class="modal-title">Menu</div>
                        <button id="menu-close" class="modal-close" aria-label="Close">√ó</button>
                    </div>
                    <div id="menu-body" class="modal-body"></div>
                </div>
        </div>
        <!-- Role overlay modal -->
        <div id="role-overlay" class="modal-overlay">
            <div class="modal-card">
                <div class="modal-header">
                    <div class="modal-title">Your Secret Role</div>
                    <button id="role-close" class="modal-close" aria-label="Close">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="role-content">
                        <div class="role-display">
                            <div class="role-label" id="role-text">Hidden</div>
                        </div>
                                            <div class="role-actions">
                        <div class="role-actions-main">
                            <button id="membership-btn" class="btn btn-secondary">üèõÔ∏è View Membership</button>
                            <button id="role-btn" class="btn btn-primary">üëÅÔ∏è View Role</button>
                            <button id="compatriots-btn" class="btn btn-secondary" style="display: none;">üë• View Comrades</button>
                        </div>
                        <button id="role-done-btn" class="btn">‚úÖ Close</button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="preloader-overlay" class="preloader-overlay" aria-hidden="false">
        <div class="loader">
            <div class="spinner"></div>
            <div id="preloader-text" class="loader-text">Loading board‚Ä¶</div>
        </div>
    </div>
<script type="module" src="../js/gameplay.js"></script>
</body>
</html>