<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Fascist Slots Test - Secret Hitler</title>
    <link rel="stylesheet" href="styles/app.css">
    <link rel="stylesheet" href="pages/parts/play-styles.css">
    <link rel="stylesheet" href="pages/parts/play-specific.css">
    <style>
        .test-controls {
            background: var(--off-white);
            padding: 20px;
            margin: 20px;
            border: 3px solid var(--propaganda-black);
            border-radius: 12px;
            text-align: center;
        }
        .test-controls h2 {
            margin-top: 0;
            font-family: var(--font-fraktur);
        }
        .player-count-btn {
            margin: 5px;
            padding: 10px 20px;
            font-size: 1.1rem;
            min-width: 80px;
        }
        .current-config {
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 174, 239, 0.1);
            border: 2px solid var(--liberal-blue);
            border-radius: 8px;
        }
        .log-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="play-wrapper">
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <span class="logo-icon">üé≠</span>
                        <div class="logo-text">
                            <h1>Secret Hitler</h1>
                            <p class="subtitle">Dynamic Slots Test</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="test-controls">
            <h2>üéØ Dynamic Fascist Slot Test</h2>
            <p>Click the buttons below to test how fascist slots 1-3 update based on player count:</p>
            
            <div class="current-config">
                <strong>Current Configuration:</strong> <span id="current-config-text">5-6 players</span>
            </div>
            
            <div class="player-count-buttons">
                <button class="btn btn-primary player-count-btn" data-count="5">5 Players</button>
                <button class="btn btn-primary player-count-btn" data-count="6">6 Players</button>
                <button class="btn btn-primary player-count-btn" data-count="7">7 Players</button>
                <button class="btn btn-primary player-count-btn" data-count="8">8 Players</button>
                <button class="btn btn-primary player-count-btn" data-count="9">9 Players</button>
                <button class="btn btn-primary player-count-btn" data-count="10">10 Players</button>
            </div>
        </div>

        <main class="play-main">
            <div class="board-shell">
                <div class="board-area">
                    <div class="board-frame">
                        <div class="tracks">
                            <section class="track fascist">
                                <div class="track-title">Fascist Policies (Dynamic Slot Test)</div>
                                <div class="slots" id="fascist-slots">
                                    <!-- Slots will be generated by JavaScript -->
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div class="log-output" id="log-output">
            Console Log Output:
            
        </div>
    </div>

    <script type="module">
        // Mock the dependencies and import only what we need for testing
        const latestGame = { playerCount: 5 };
        const latestPlayers = Array(5).fill().map((_, i) => ({ id: `player${i}`, name: `Player ${i+1}` }));

        // Extract just the functions we need from gameplay.js for testing
        function updateFascistSlotsForPlayerCount(containerEl, playerCount) {
            if (!containerEl || containerEl.children.length < 6) return;
            
            // Clear any existing overlays in slots 1-3 first
            for (let i = 0; i < 3; i++) {
                const slot = containerEl.children[i];
                if (slot && !slot.classList.contains('filled')) {
                    // Remove existing overlays
                    const existingOverlays = slot.querySelectorAll('.eyeglass-overlay, .president-overlay, .trio-cards-overlay, .trio-cards-eye-overlay');
                    existingOverlays.forEach(overlay => overlay.remove());
                }
            }
            
            console.log(`üéØ Updating fascist slots for player count: ${playerCount}`);
            logToOutput(`üéØ Updating fascist slots for player count: ${playerCount}`);
            
            // Configure slots based on player count
            if (playerCount >= 5 && playerCount <= 6) {
                // 5-6 players: Slot 3 gets trio-cards-eye
                addTrioCardsEyeToSlot(containerEl.children[2]); // Slot 3 (index 2)
                console.log('‚úÖ 5-6 player configuration: Slot 3 = trio-cards-eye');
                logToOutput('‚úÖ 5-6 player configuration: Slot 3 = trio-cards-eye');
                updateConfigText('5-6 players: Slot 3 = Policy Peek Power (trio-cards-eye)');
                
            } else if (playerCount >= 7 && playerCount <= 8) {
                // 7-8 players: Slot 2 gets eyeglass, Slot 3 gets president
                addEyeglassToSlot(containerEl.children[1]); // Slot 2 (index 1)
                addPresidentToSlot(containerEl.children[2]); // Slot 3 (index 2)
                console.log('‚úÖ 7-8 player configuration: Slot 2 = eyeglass, Slot 3 = president');
                logToOutput('‚úÖ 7-8 player configuration: Slot 2 = eyeglass, Slot 3 = president');
                updateConfigText('7-8 players: Slot 2 = Investigation Power (eyeglass), Slot 3 = Special Election Power (president)');
                
            } else if (playerCount >= 9 && playerCount <= 10) {
                // 9-10 players: Slots 1 & 2 get eyeglass, Slot 3 gets president
                addEyeglassToSlot(containerEl.children[0]); // Slot 1 (index 0)
                addEyeglassToSlot(containerEl.children[1]); // Slot 2 (index 1)
                addPresidentToSlot(containerEl.children[2]); // Slot 3 (index 2)
                console.log('‚úÖ 9-10 player configuration: Slots 1&2 = eyeglass, Slot 3 = president');
                logToOutput('‚úÖ 9-10 player configuration: Slots 1&2 = eyeglass, Slot 3 = president');
                updateConfigText('9-10 players: Slots 1&2 = Investigation Power (eyeglass), Slot 3 = Special Election Power (president)');
            }
        }

        // Helper functions
        function addEyeglassToSlot(slot) {
            if (!slot || slot.classList.contains('filled')) return;
            
            const existingOverlay = slot.querySelector('.eyeglass-overlay');
            if (!existingOverlay) {
                const overlay = document.createElement('div');
                overlay.className = 'eyeglass-overlay';
                overlay.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 32px;
                    height: auto;
                    pointer-events: none;
                    z-index: 15;
                    opacity: 1.0;
                    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
                `;
                overlay.innerHTML = '<img src="images/eyeglass.png" alt="Investigation Power" style="width: 100%; height: auto;">';
                slot.appendChild(overlay);
                logToOutput('üëì Eyeglass overlay added to fascist slot');
            }
        }

        function addPresidentToSlot(slot) {
            if (!slot || slot.classList.contains('filled')) return;
            
            const existingOverlay = slot.querySelector('.president-overlay');
            if (!existingOverlay) {
                const overlay = document.createElement('div');
                overlay.className = 'president-overlay';
                overlay.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 32px;
                    height: auto;
                    pointer-events: none;
                    z-index: 15;
                    opacity: 1.0;
                    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
                `;
                overlay.innerHTML = '<img src="images/president.png" alt="Special Election Power" style="width: 100%; height: auto;">';
                slot.appendChild(overlay);
                logToOutput('üëë President overlay added to fascist slot');
            }
        }

        function addTrioCardsEyeToSlot(slot) {
            if (!slot || slot.classList.contains('filled')) return;
            
            const existingOverlay = slot.querySelector('.trio-cards-eye-overlay');
            if (!existingOverlay) {
                const overlay = document.createElement('div');
                overlay.className = 'trio-cards-eye-overlay';
                overlay.style.cssText = `
                    position: absolute;
                    top: 55%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 36.4px;
                    height: auto;
                    pointer-events: none;
                    z-index: 15;
                    opacity: 1.0;
                    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
                `;
                overlay.innerHTML = '<img src="images/trio-cards-eye.png" alt="Policy Peek Power" style="width: 100%; height: auto;">';
                slot.appendChild(overlay);
                logToOutput('üîç Trio-cards-eye overlay added to fascist slot');
            }
        }

        function logToOutput(message) {
            const logEl = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateConfigText(text) {
            document.getElementById('current-config-text').textContent = text;
        }

        // Initialize the slots
        function renderSlots(el, count) {
            if (!el) return;
            el.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const s = document.createElement('div');
                s.className = 'slot';
                el.appendChild(s);
            }
        }

        // Initialize the board
        const fascistSlots = document.getElementById('fascist-slots');
        renderSlots(fascistSlots, 6);
        
        // Add skull backgrounds for all slots (simplified version)
        for (let i = 0; i < 6; i++) {
            const slot = fascistSlots.children[i];
            if (slot) {
                const skullBackground = document.createElement('div');
                skullBackground.className = 'skull-background';
                skullBackground.style.cssText = `
                    position: absolute;
                    inset: 0;
                    background-image: url('images/skull.png');
                    background-repeat: no-repeat;
                    background-position: center;
                    background-size: 46% auto;
                    opacity: ${i < 3 ? '0.15' : '0.75'};
                    filter: brightness(0) invert(1);
                    pointer-events: none;
                    z-index: 1;
                `;
                slot.appendChild(skullBackground);
            }
        }

        // Set initial state to 5 players
        updateFascistSlotsForPlayerCount(fascistSlots, 5);

        // Add event listeners for testing
        document.addEventListener('click', (event) => {
            if (event.target.classList.contains('player-count-btn')) {
                const count = parseInt(event.target.dataset.count);
                logToOutput(`\n=== Testing ${count} player configuration ===`);
                updateFascistSlotsForPlayerCount(fascistSlots, count);
            }
        });

        logToOutput('üöÄ Dynamic fascist slots test initialized');
        logToOutput('Click the player count buttons to see how slots 1-3 update!');
    </script>
</body>
</html>